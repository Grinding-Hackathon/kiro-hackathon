# Offline Blockchain Wallet - Complete System Documentation\n\n## üìã Table of Contents\n\n1. [System Overview](#system-overview)\n2. [Backend Documentation](#backend-documentation)\n3. [Mobile (iOS) Documentation](#mobile-ios-documentation)\n4. [Deployment Guide](#deployment-guide)\n5. [API Reference](#api-reference)\n6. [Security Guide](#security-guide)\n7. [Troubleshooting](#troubleshooting)\n8. [Development Workflow](#development-workflow)\n\n---\n\n## üéØ System Overview\n\n### Architecture\n\nThe Offline Blockchain Wallet is a distributed system consisting of:\n\n- **Backend API**: Node.js/TypeScript REST API with PostgreSQL database\n- **iOS Mobile App**: SwiftUI-based mobile application\n- **Blockchain Integration**: Ethereum smart contracts for token management\n- **Offline Capabilities**: Peer-to-peer transactions via Bluetooth and QR codes\n\n### Key Features\n\n- üîê **Secure Authentication**: JWT-based authentication with multi-factor support\n- üí∞ **Token Management**: Purchase, store, and redeem blockchain tokens\n- üì± **Offline Transactions**: Bluetooth and QR code-based peer-to-peer transfers\n- üîÑ **Synchronization**: Automatic sync when network connectivity is restored\n- üõ°Ô∏è **Security**: End-to-end encryption, digital signatures, fraud detection\n- üìä **Monitoring**: Real-time health monitoring and alerting\n\n### Technology Stack\n\n**Backend:**\n- Node.js 18+ with TypeScript\n- Express.js framework\n- PostgreSQL database\n- Redis for caching\n- Web3.js for blockchain integration\n- Jest for testing\n\n**Mobile:**\n- iOS 15+ with SwiftUI\n- Core Data for local storage\n- CryptoKit for cryptography\n- Bluetooth LE for peer-to-peer communication\n- AVFoundation for QR code scanning\n\n**Infrastructure:**\n- Docker containers\n- Nginx reverse proxy\n- SSL/TLS encryption\n- Prometheus monitoring\n- Grafana dashboards\n\n---\n\n## üñ•Ô∏è Backend Documentation\n\n### Quick Start\n\n```bash\n# Clone and setup\ncd backend\nnpm install\n\n# Setup environment\ncp .env.example .env\n# Edit .env with your configuration\n\n# Setup database\nnpm run db:migrate\nnpm run db:seed\n\n# Start development server\nnpm run dev\n```\n\n### Project Structure\n\n```\nbackend/\n‚îú‚îÄ‚îÄ src/\n‚îÇ   ‚îú‚îÄ‚îÄ controllers/          # API route handlers\n‚îÇ   ‚îú‚îÄ‚îÄ services/            # Business logic\n‚îÇ   ‚îú‚îÄ‚îÄ database/            # Database layer\n‚îÇ   ‚îú‚îÄ‚îÄ middleware/          # Express middleware\n‚îÇ   ‚îú‚îÄ‚îÄ routes/              # API routes\n‚îÇ   ‚îú‚îÄ‚îÄ models/              # Data models\n‚îÇ   ‚îú‚îÄ‚îÄ utils/               # Utility functions\n‚îÇ   ‚îî‚îÄ‚îÄ config/              # Configuration\n‚îú‚îÄ‚îÄ contracts/               # Smart contracts\n‚îú‚îÄ‚îÄ infrastructure/          # Docker, configs\n‚îú‚îÄ‚îÄ scripts/                 # Deployment scripts\n‚îî‚îÄ‚îÄ test/                    # Test files\n```\n\n### Core Services\n\n#### Authentication Service\n- JWT token generation and validation\n- Multi-factor authentication support\n- Session management\n- Password security (bcrypt hashing)\n\n#### Wallet Service\n- User wallet creation and management\n- Balance tracking\n- Transaction history\n- Multi-signature support\n\n#### Token Service\n- Offline token generation\n- Token validation and verification\n- Token division for change-making\n- Expiration handling\n\n#### Blockchain Service\n- Smart contract interaction\n- Transaction broadcasting\n- Balance synchronization\n- Gas fee estimation\n\n#### Security Service\n- Fraud detection algorithms\n- Audit logging\n- Rate limiting\n- Input validation\n\n### Database Schema\n\n#### Users Table\n```sql\nCREATE TABLE users (\n    id UUID PRIMARY KEY,\n    username VARCHAR(255) UNIQUE NOT NULL,\n    email VARCHAR(255) UNIQUE NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n    public_key TEXT,\n    wallet_address VARCHAR(42),\n    created_at TIMESTAMP DEFAULT NOW(),\n    updated_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n#### Offline Tokens Table\n```sql\nCREATE TABLE offline_tokens (\n    id UUID PRIMARY KEY,\n    user_id UUID REFERENCES users(id),\n    amount DECIMAL(18,8) NOT NULL,\n    signature TEXT NOT NULL,\n    is_spent BOOLEAN DEFAULT FALSE,\n    expires_at TIMESTAMP,\n    created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n#### Transactions Table\n```sql\nCREATE TABLE transactions (\n    id UUID PRIMARY KEY,\n    sender_id UUID REFERENCES users(id),\n    receiver_id UUID REFERENCES users(id),\n    amount DECIMAL(18,8) NOT NULL,\n    type VARCHAR(50) NOT NULL,\n    status VARCHAR(50) DEFAULT 'pending',\n    blockchain_hash VARCHAR(66),\n    created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### API Endpoints\n\n#### Authentication\n```\nPOST /api/auth/register     # User registration\nPOST /api/auth/login        # User login\nPOST /api/auth/logout       # User logout\nPOST /api/auth/refresh      # Refresh JWT token\n```\n\n#### Wallet Management\n```\nGET  /api/wallet/balance    # Get wallet balance\nPOST /api/wallet/purchase   # Purchase tokens\nPOST /api/wallet/redeem     # Redeem tokens\nGET  /api/wallet/history    # Transaction history\n```\n\n#### Offline Tokens\n```\nPOST /api/tokens/generate   # Generate offline tokens\nPOST /api/tokens/validate   # Validate token\nPOST /api/tokens/divide     # Divide token for change\nPOST /api/tokens/sync       # Sync offline transactions\n```\n\n### Configuration\n\n#### Environment Variables\n```bash\n# Server\nPORT=3000\nNODE_ENV=production\n\n# Database\nDB_HOST=localhost\nDB_PORT=5432\nDB_NAME=wallet_db\nDB_USER=wallet_user\nDB_PASSWORD=secure_password\n\n# JWT\nJWT_SECRET=your_jwt_secret\nJWT_EXPIRES_IN=24h\n\n# Blockchain\nETH_RPC_URL=https://mainnet.infura.io/v3/your_key\nCONTRACT_ADDRESS=0x...\nPRIVATE_KEY=0x...\n\n# Redis\nREDIS_URL=redis://localhost:6379\n\n# Security\nRATE_LIMIT_WINDOW=15\nRATE_LIMIT_MAX=100\n```\n\n### Testing\n\n```bash\n# Run all tests\nnpm test\n\n# Run specific test suites\nnpm run test:unit\nnpm run test:integration\nnpm run test:security\n\n# Run with coverage\nnpm run test:coverage\n\n# Run load tests\nnpm run test:load\n```\n\n### Monitoring\n\n#### Health Checks\n- `/health` - Basic health status\n- `/health/detailed` - Detailed system status\n- `/metrics` - Prometheus metrics\n\n#### Logging\n- Structured JSON logging\n- Log levels: error, warn, info, debug\n- Audit trail for security events\n- Performance metrics\n\n---\n\n## üì± Mobile (iOS) Documentation\n\n### Quick Start\n\n```bash\n# Setup Xcode project\ncd ios/offline-blockchain-wallet-ios\n./configure_project.sh\n\n# Install dependencies\nswift package resolve\n\n# Open in Xcode\nopen offline-blockchain-wallet-ios.xcodeproj\n```\n\n### Project Structure\n\n```\nios/offline-blockchain-wallet-ios/\n‚îú‚îÄ‚îÄ offline-blockchain-wallet-ios/\n‚îÇ   ‚îú‚îÄ‚îÄ Views/               # SwiftUI views\n‚îÇ   ‚îú‚îÄ‚îÄ ViewModels/          # MVVM view models\n‚îÇ   ‚îú‚îÄ‚îÄ Services/            # Business logic services\n‚îÇ   ‚îú‚îÄ‚îÄ Models/              # Data models\n‚îÇ   ‚îú‚îÄ‚îÄ Utils/               # Utility classes\n‚îÇ   ‚îî‚îÄ‚îÄ Configuration/       # App configuration\n‚îú‚îÄ‚îÄ Tests/                   # Unit tests\n‚îú‚îÄ‚îÄ Scripts/                 # Build scripts\n‚îî‚îÄ‚îÄ Package.swift            # Dependencies\n```\n\n### Core Services\n\n#### Network Service\n- API communication with backend\n- Request/response handling\n- Network connectivity monitoring\n- Offline queue management\n\n#### Cryptography Service\n- Key pair generation (secp256k1)\n- Digital signature creation/verification\n- Hash functions (SHA-256)\n- Secure random number generation\n\n#### Storage Service\n- Core Data integration\n- Keychain storage for sensitive data\n- Local transaction caching\n- Data synchronization\n\n#### Bluetooth Service\n- Bluetooth LE advertising\n- Device discovery and pairing\n- Secure data transmission\n- Connection management\n\n#### QR Code Service\n- QR code generation\n- QR code scanning\n- Data encoding/decoding\n- Error correction\n\n#### Offline Token Service\n- Token validation\n- Token division for payments\n- Balance calculations\n- Expiration handling\n\n### Key Features Implementation\n\n#### Offline Transactions\n\n```swift\n// Generate payment QR code\nlet paymentRequest = QRCodePaymentRequest(\n    type: .payment,\n    walletId: currentWallet.id,\n    amount: paymentAmount,\n    timestamp: Date()\n)\n\nlet qrCode = try qrCodeService.generateQRCode(for: paymentRequest)\n```\n\n#### Bluetooth Communication\n\n```swift\n// Start advertising wallet\ntry bluetoothService.startAdvertising(walletInfo: WalletInfo(\n    walletId: wallet.id,\n    publicKey: wallet.publicKey\n))\n\n// Handle incoming connection\nfunc handleIncomingConnection(_ connection: BluetoothConnection) {\n    // Verify peer identity\n    // Exchange transaction data\n    // Process offline payment\n}\n```\n\n#### Token Management\n\n```swift\n// Validate offline token\nlet isValid = offlineTokenService.validateToken(token)\n\n// Divide token for payment\nlet divisionResult = try offlineTokenService.divideToken(\n    token,\n    amount: paymentAmount\n)\n```\n\n### User Interface\n\n#### Main Wallet View\n- Balance display\n- Recent transactions\n- Quick actions (send, receive, purchase)\n- Offline status indicator\n\n#### Transaction View\n- Transaction creation\n- QR code display/scanning\n- Bluetooth device selection\n- Transaction confirmation\n\n#### Settings View\n- Account management\n- Security settings\n- Network configuration\n- Backup/restore options\n\n### Data Models\n\n#### Wallet Model\n```swift\nstruct Wallet: Codable {\n    let id: String\n    let publicKey: String\n    let address: String\n    var balance: Double\n    let createdAt: Date\n}\n```\n\n#### Transaction Model\n```swift\nstruct Transaction: Codable {\n    let id: String\n    let senderId: String\n    let receiverId: String\n    let amount: Double\n    let type: TransactionType\n    var status: TransactionStatus\n    let timestamp: Date\n}\n```\n\n#### Offline Token Model\n```swift\nstruct OfflineToken: Codable {\n    let id: String\n    let amount: Double\n    let signature: String\n    let expiresAt: Date\n    var isSpent: Bool\n}\n```\n\n### Security Implementation\n\n#### Key Management\n- Secure Enclave integration\n- Keychain storage for private keys\n- Biometric authentication\n- Key rotation support\n\n#### Transaction Security\n- Digital signature verification\n- Double-spending prevention\n- Replay attack protection\n- Secure communication channels\n\n### Testing\n\n```bash\n# Run unit tests\nswift test\n\n# Run specific test\nswift test --filter CryptographyServiceTests\n\n# Run standalone tests\nswift test_crypto_standalone.swift\nswift test_offline_token_service.swift\nswift test_transaction_service.swift\n```\n\n### Build Configuration\n\n#### Debug Configuration\n```swift\n// Debug.xcconfig\nAPI_BASE_URL = https://dev-api.wallet.com\nLOG_LEVEL = DEBUG\nENABLE_MOCK_SERVICES = YES\n```\n\n#### Release Configuration\n```swift\n// Release.xcconfig\nAPI_BASE_URL = https://api.wallet.com\nLOG_LEVEL = ERROR\nENABLE_MOCK_SERVICES = NO\n```\n\n---\n\n## üöÄ Deployment Guide\n\n### Prerequisites\n\n- Docker and Docker Compose\n- PostgreSQL 13+\n- Redis 6+\n- SSL certificates\n- Domain name\n- Ethereum node access\n\n### Backend Deployment\n\n#### 1. Environment Setup\n\n```bash\n# Create production environment file\ncp backend/.env.example backend/.env.production\n\n# Edit with production values\nvim backend/.env.production\n```\n\n#### 2. Database Setup\n\n```bash\n# Start PostgreSQL\ndocker-compose -f backend/infrastructure/docker-compose.prod.yml up -d postgres\n\n# Run migrations\ncd backend\nnpm run db:migrate:prod\n```\n\n#### 3. SSL Certificate Setup\n\n```bash\n# Generate SSL certificates (Let's Encrypt)\ncd backend\n./scripts/setup-ssl.sh your-domain.com\n```\n\n#### 4. Deploy Backend Services\n\n```bash\n# Build and deploy\ncd backend\n./scripts/deploy-production.sh\n\n# Verify deployment\ncurl https://your-domain.com/health\n```\n\n#### 5. Smart Contract Deployment\n\n```bash\n# Deploy to mainnet\ncd backend\nnpm run deploy:mainnet\n\n# Verify contract\nnpm run verify:contract\n```\n\n### Mobile App Deployment\n\n#### 1. App Store Preparation\n\n```bash\n# Update version and build number\ncd ios/offline-blockchain-wallet-ios\n./scripts/update-version.sh 1.0.0\n\n# Configure release settings\nvim offline-blockchain-wallet-ios/Configuration/Release.xcconfig\n```\n\n#### 2. Build for Release\n\n```bash\n# Clean and build\n./scripts/build.sh --release\n\n# Run tests\nswift test\n\n# Archive for App Store\nxcodebuild archive -scheme offline-blockchain-wallet-ios \\\n  -archivePath build/offline-blockchain-wallet-ios.xcarchive\n```\n\n#### 3. App Store Submission\n\n```bash\n# Export for App Store\nxcodebuild -exportArchive \\\n  -archivePath build/offline-blockchain-wallet-ios.xcarchive \\\n  -exportPath build/AppStore \\\n  -exportOptionsPlist ExportOptions.plist\n\n# Upload to App Store Connect\nxcrun altool --upload-app \\\n  -f build/AppStore/offline-blockchain-wallet-ios.ipa \\\n  -u your-apple-id@example.com\n```\n\n### Infrastructure Setup\n\n#### Docker Compose Configuration\n\n```yaml\n# docker-compose.prod.yml\nversion: '3.8'\nservices:\n  app:\n    build: .\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=production\n    depends_on:\n      - postgres\n      - redis\n\n  postgres:\n    image: postgres:13\n    environment:\n      POSTGRES_DB: wallet_db\n      POSTGRES_USER: wallet_user\n      POSTGRES_PASSWORD: ${DB_PASSWORD}\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n\n  redis:\n    image: redis:6-alpine\n    volumes:\n      - redis_data:/data\n\n  nginx:\n    image: nginx:alpine\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - ./nginx.conf:/etc/nginx/nginx.conf\n      - ./ssl:/etc/ssl\n```\n\n#### Nginx Configuration\n\n```nginx\nserver {\n    listen 443 ssl http2;\n    server_name your-domain.com;\n\n    ssl_certificate /etc/ssl/cert.pem;\n    ssl_certificate_key /etc/ssl/key.pem;\n\n    location / {\n        proxy_pass http://app:3000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n\n    location /health {\n        proxy_pass http://app:3000/health;\n        access_log off;\n    }\n}\n```\n\n### Monitoring Setup\n\n#### Prometheus Configuration\n\n```yaml\n# prometheus.yml\nglobal:\n  scrape_interval: 15s\n\nscrape_configs:\n  - job_name: 'wallet-api'\n    static_configs:\n      - targets: ['app:3000']\n    metrics_path: '/metrics'\n```\n\n#### Grafana Dashboard\n\n```json\n{\n  \"dashboard\": {\n    \"title\": \"Wallet API Monitoring\",\n    \"panels\": [\n      {\n        \"title\": \"Request Rate\",\n        \"type\": \"graph\",\n        \"targets\": [\n          {\n            \"expr\": \"rate(http_requests_total[5m])\"\n          }\n        ]\n      },\n      {\n        \"title\": \"Response Time\",\n        \"type\": \"graph\",\n        \"targets\": [\n          {\n            \"expr\": \"histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Security Hardening\n\n#### 1. Firewall Configuration\n\n```bash\n# Allow only necessary ports\nufw allow 22/tcp   # SSH\nufw allow 80/tcp   # HTTP\nufw allow 443/tcp  # HTTPS\nufw enable\n```\n\n#### 2. Database Security\n\n```bash\n# Configure PostgreSQL security\nvim /etc/postgresql/13/main/pg_hba.conf\n\n# Restrict connections\nhost    wallet_db    wallet_user    127.0.0.1/32    md5\n```\n\n#### 3. SSL/TLS Configuration\n\n```bash\n# Generate strong SSL configuration\nopenssl dhparam -out /etc/ssl/dhparam.pem 2048\n\n# Configure nginx SSL\nssl_protocols TLSv1.2 TLSv1.3;\nssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;\nssl_prefer_server_ciphers off;\nssl_dhparam /etc/ssl/dhparam.pem;\n```\n\n### Backup and Recovery\n\n#### Database Backup\n\n```bash\n# Automated backup script\n#!/bin/bash\nBACKUP_DIR=\"/backups/postgres\"\nDATE=$(date +%Y%m%d_%H%M%S)\n\npg_dump -h localhost -U wallet_user wallet_db > \\\n  \"$BACKUP_DIR/wallet_db_$DATE.sql\"\n\n# Compress and encrypt\ngzip \"$BACKUP_DIR/wallet_db_$DATE.sql\"\ngpg --encrypt --recipient backup@company.com \\\n  \"$BACKUP_DIR/wallet_db_$DATE.sql.gz\"\n```\n\n#### Recovery Process\n\n```bash\n# Restore from backup\ngpg --decrypt backup_file.sql.gz.gpg | gunzip | \\\n  psql -h localhost -U wallet_user wallet_db\n```\n\n### Deployment Checklist\n\n#### Pre-Deployment\n- [ ] All tests passing\n- [ ] Security audit completed\n- [ ] Performance testing done\n- [ ] Backup procedures tested\n- [ ] SSL certificates valid\n- [ ] Environment variables configured\n- [ ] Database migrations ready\n\n#### Deployment\n- [ ] Deploy backend services\n- [ ] Run database migrations\n- [ ] Deploy smart contracts\n- [ ] Configure monitoring\n- [ ] Test all endpoints\n- [ ] Verify SSL configuration\n- [ ] Check logs for errors\n\n#### Post-Deployment\n- [ ] Monitor system metrics\n- [ ] Verify backup procedures\n- [ ] Test disaster recovery\n- [ ] Update documentation\n- [ ] Notify stakeholders\n\n---\n\n## üìö API Reference\n\n### Authentication Endpoints\n\n#### POST /api/auth/register\nRegister a new user account.\n\n**Request:**\n```json\n{\n  \"username\": \"john_doe\",\n  \"email\": \"john@example.com\",\n  \"password\": \"secure_password123\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"userId\": \"uuid-here\",\n    \"token\": \"jwt-token-here\",\n    \"expiresIn\": \"24h\"\n  }\n}\n```\n\n#### POST /api/auth/login\nAuthenticate user and get access token.\n\n**Request:**\n```json\n{\n  \"email\": \"john@example.com\",\n  \"password\": \"secure_password123\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"token\": \"jwt-token-here\",\n    \"refreshToken\": \"refresh-token-here\",\n    \"expiresIn\": \"24h\",\n    \"user\": {\n      \"id\": \"uuid-here\",\n      \"username\": \"john_doe\",\n      \"email\": \"john@example.com\"\n    }\n  }\n}\n```\n\n### Wallet Endpoints\n\n#### GET /api/wallet/balance\nGet current wallet balance.\n\n**Headers:**\n```\nAuthorization: Bearer jwt-token-here\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"balance\": 150.75,\n    \"offlineBalance\": 25.50,\n    \"pendingBalance\": 10.00,\n    \"currency\": \"ETH\"\n  }\n}\n```\n\n#### POST /api/wallet/purchase\nPurchase tokens for offline use.\n\n**Request:**\n```json\n{\n  \"amount\": 100.00,\n  \"paymentMethod\": \"ethereum\",\n  \"transactionHash\": \"0x...\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"tokens\": [\n      {\n        \"id\": \"token-uuid-1\",\n        \"amount\": 50.00,\n        \"signature\": \"signature-here\",\n        \"expiresAt\": \"2024-02-01T00:00:00Z\"\n      },\n      {\n        \"id\": \"token-uuid-2\",\n        \"amount\": 50.00,\n        \"signature\": \"signature-here\",\n        \"expiresAt\": \"2024-02-01T00:00:00Z\"\n      }\n    ],\n    \"transactionId\": \"transaction-uuid\"\n  }\n}\n```\n\n### Token Endpoints\n\n#### POST /api/tokens/validate\nValidate an offline token.\n\n**Request:**\n```json\n{\n  \"tokenId\": \"token-uuid\",\n  \"signature\": \"signature-here\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"valid\": true,\n    \"amount\": 50.00,\n    \"expiresAt\": \"2024-02-01T00:00:00Z\",\n    \"isSpent\": false\n  }\n}\n```\n\n#### POST /api/tokens/divide\nDivide a token for making change.\n\n**Request:**\n```json\n{\n  \"tokenId\": \"token-uuid\",\n  \"paymentAmount\": 30.00\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"paymentToken\": {\n      \"id\": \"payment-token-uuid\",\n      \"amount\": 30.00,\n      \"signature\": \"payment-signature\"\n    },\n    \"changeToken\": {\n      \"id\": \"change-token-uuid\",\n      \"amount\": 20.00,\n      \"signature\": \"change-signature\"\n    }\n  }\n}\n```\n\n### Error Responses\n\nAll endpoints return errors in this format:\n\n```json\n{\n  \"success\": false,\n  \"error\": {\n    \"code\": \"INVALID_TOKEN\",\n    \"message\": \"The provided token is invalid or expired\",\n    \"details\": {\n      \"tokenId\": \"token-uuid\",\n      \"reason\": \"expired\"\n    }\n  }\n}\n```\n\n### Rate Limiting\n\nAll endpoints are rate limited:\n- **Default**: 100 requests per 15 minutes per IP\n- **Authentication**: 5 requests per 15 minutes per IP\n- **Token operations**: 50 requests per 15 minutes per user\n\nRate limit headers:\n```\nX-RateLimit-Limit: 100\nX-RateLimit-Remaining: 95\nX-RateLimit-Reset: 1640995200\n```\n\n---\n\n## üîí Security Guide\n\n### Authentication Security\n\n#### JWT Token Security\n- Tokens expire after 24 hours\n- Refresh tokens for seamless renewal\n- Secure token storage in mobile app\n- Token blacklisting on logout\n\n#### Password Security\n- bcrypt hashing with salt rounds: 12\n- Minimum password requirements\n- Password history prevention\n- Account lockout after failed attempts\n\n### Cryptographic Security\n\n#### Key Management\n- secp256k1 elliptic curve cryptography\n- Secure random number generation\n- Private key storage in Secure Enclave (iOS)\n- Key rotation capabilities\n\n#### Digital Signatures\n- ECDSA signatures for all transactions\n- Message authentication codes (MAC)\n- Timestamp-based replay protection\n- Signature verification on all operations\n\n### Network Security\n\n#### HTTPS/TLS\n- TLS 1.2+ only\n- Perfect Forward Secrecy\n- HSTS headers\n- Certificate pinning in mobile app\n\n#### API Security\n- Input validation and sanitization\n- SQL injection prevention\n- XSS protection\n- CSRF tokens\n\n### Blockchain Security\n\n#### Smart Contract Security\n- Reentrancy protection\n- Integer overflow/underflow checks\n- Access control modifiers\n- Emergency pause functionality\n\n#### Transaction Security\n- Double-spending prevention\n- Transaction replay protection\n- Gas limit optimization\n- Multi-signature requirements\n\n### Mobile Security\n\n#### Data Protection\n- Core Data encryption\n- Keychain storage for sensitive data\n- App Transport Security (ATS)\n- Jailbreak detection\n\n#### Biometric Authentication\n- Touch ID / Face ID integration\n- Fallback to passcode\n- Biometric template protection\n- Authentication timeout\n\n### Monitoring and Alerting\n\n#### Security Monitoring\n- Failed authentication attempts\n- Suspicious transaction patterns\n- Rate limit violations\n- Unusual API usage\n\n#### Incident Response\n- Automated alert notifications\n- Security event logging\n- Forensic data collection\n- Emergency response procedures\n\n---\n\n## üîß Troubleshooting\n\n### Common Backend Issues\n\n#### Database Connection Issues\n```bash\n# Check database status\nsudo systemctl status postgresql\n\n# Test connection\npsql -h localhost -U wallet_user -d wallet_db\n\n# Check logs\ntail -f /var/log/postgresql/postgresql-13-main.log\n```\n\n#### JWT Token Issues\n```bash\n# Verify JWT secret is set\necho $JWT_SECRET\n\n# Check token expiration\nnode -e \"console.log(require('jsonwebtoken').decode('your-token-here'))\"\n```\n\n#### Blockchain Connection Issues\n```bash\n# Test Ethereum RPC connection\ncurl -X POST -H \"Content-Type: application/json\" \\\n  --data '{\"jsonrpc\":\"2.0\",\"method\":\"eth_blockNumber\",\"params\":[],\"id\":1}' \\\n  $ETH_RPC_URL\n```\n\n### Common Mobile Issues\n\n#### Build Issues\n```bash\n# Clean build folder\nrm -rf ios/offline-blockchain-wallet-ios/.build\n\n# Reset package dependencies\nswift package reset\nswift package resolve\n\n# Fix signing issues\n./scripts/fix_build_issues.sh\n```\n\n#### Bluetooth Issues\n```swift\n// Check Bluetooth permissions\nif CBCentralManager.authorization != .allowedAlways {\n    // Request permissions\n}\n\n// Reset Bluetooth state\nbluetoothService.reset()\n```\n\n#### Keychain Issues\n```swift\n// Clear keychain data\nlet keychain = Keychain(service: \"com.wallet.app\")\ntry keychain.removeAll()\n\n// Check keychain accessibility\nlet accessibility = keychain.accessibility\n```\n\n### Performance Issues\n\n#### High Memory Usage\n```bash\n# Monitor memory usage\ntop -p $(pgrep node)\n\n# Check for memory leaks\nnode --inspect app.js\n# Open chrome://inspect in Chrome\n```\n\n#### Slow Database Queries\n```sql\n-- Enable query logging\nSET log_statement = 'all';\nSET log_min_duration_statement = 1000;\n\n-- Analyze slow queries\nSELECT query, mean_time, calls \nFROM pg_stat_statements \nORDER BY mean_time DESC;\n```\n\n#### High CPU Usage\n```bash\n# Profile Node.js application\nnode --prof app.js\nnode --prof-process isolate-*.log > processed.txt\n```\n\n### Network Issues\n\n#### SSL Certificate Problems\n```bash\n# Check certificate validity\nopenssl x509 -in cert.pem -text -noout\n\n# Test SSL connection\nopenssl s_client -connect your-domain.com:443\n```\n\n#### DNS Issues\n```bash\n# Test DNS resolution\nnslookup your-domain.com\ndig your-domain.com\n\n# Check DNS propagation\ndig @8.8.8.8 your-domain.com\n```\n\n### Deployment Issues\n\n#### Docker Container Issues\n```bash\n# Check container logs\ndocker logs container-name\n\n# Debug container\ndocker exec -it container-name /bin/bash\n\n# Check resource usage\ndocker stats\n```\n\n#### Load Balancer Issues\n```bash\n# Check nginx status\nsudo systemctl status nginx\n\n# Test upstream servers\ncurl -H \"Host: your-domain.com\" http://backend-server:3000/health\n\n# Check nginx logs\ntail -f /var/log/nginx/error.log\n```\n\n---\n\n## üîÑ Development Workflow\n\n### Git Workflow\n\n#### Branch Strategy\n```bash\n# Main branches\nmain          # Production-ready code\ndevelop       # Integration branch\nfeature/*     # Feature development\nhotfix/*      # Production fixes\nrelease/*     # Release preparation\n```\n\n#### Feature Development\n```bash\n# Create feature branch\ngit checkout -b feature/new-payment-method\n\n# Make changes and commit\ngit add .\ngit commit -m \"feat: add new payment method support\"\n\n# Push and create PR\ngit push origin feature/new-payment-method\n```\n\n### Code Quality\n\n#### Backend Linting\n```bash\n# ESLint configuration\nnpm run lint\nnpm run lint:fix\n\n# Prettier formatting\nnpm run format\n```\n\n#### Mobile Code Quality\n```bash\n# SwiftLint\nswiftlint\nswiftlint --fix\n\n# Swift format\nswift-format format --recursive .\n```\n\n### Testing Strategy\n\n#### Test Pyramid\n1. **Unit Tests** (70%): Individual functions/methods\n2. **Integration Tests** (20%): Component interactions\n3. **E2E Tests** (10%): Full user workflows\n\n#### Continuous Integration\n```yaml\n# .github/workflows/ci.yml\nname: CI\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - uses: actions/setup-node@v2\n        with:\n          node-version: '18'\n      - run: npm ci\n      - run: npm test\n      - run: npm run test:security\n```\n\n### Release Process\n\n#### Backend Release\n```bash\n# Version bump\nnpm version patch  # or minor, major\n\n# Build and test\nnpm run build\nnpm test\n\n# Deploy to staging\n./scripts/deploy-staging.sh\n\n# Deploy to production\n./scripts/deploy-production.sh\n```\n\n#### Mobile Release\n```bash\n# Update version\n./scripts/update-version.sh 1.0.1\n\n# Build and test\n./scripts/build.sh --release\nswift test\n\n# Submit to App Store\n./scripts/submit-appstore.sh\n```\n\n### Documentation\n\n#### API Documentation\n- Swagger/OpenAPI specifications\n- Postman collections\n- Code examples\n- Integration guides\n\n#### Code Documentation\n- JSDoc for JavaScript/TypeScript\n- Swift documentation comments\n- README files for each module\n- Architecture decision records (ADRs)\n\n---\n\n## üìû Support and Maintenance\n\n### Monitoring and Alerts\n\n#### System Metrics\n- CPU and memory usage\n- Database performance\n- API response times\n- Error rates\n\n#### Business Metrics\n- Transaction volume\n- User activity\n- Token utilization\n- Revenue tracking\n\n### Backup and Recovery\n\n#### Automated Backups\n- Daily database backups\n- Configuration backups\n- Log file archival\n- Disaster recovery testing\n\n#### Recovery Procedures\n- Database restoration\n- Service recovery\n- Data integrity verification\n- Business continuity planning\n\n### Security Maintenance\n\n#### Regular Security Tasks\n- Dependency updates\n- Security patch management\n- Vulnerability scanning\n- Penetration testing\n\n#### Incident Response\n- Security incident procedures\n- Communication protocols\n- Forensic analysis\n- Post-incident reviews\n\n---\n\n*This documentation is maintained by the development team and updated with each release. For questions or contributions, please contact the development team.*\n"