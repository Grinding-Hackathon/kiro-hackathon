# Backend API Documentation\n\n## ğŸ¯ Overview\n\nThe Offline Blockchain Wallet Backend API is a RESTful service built with Node.js, TypeScript, and Express.js. It provides secure endpoints for wallet management, token operations, and blockchain integration.\n\n## ğŸš€ Quick Start\n\n### Prerequisites\n- Node.js 18+\n- PostgreSQL 13+\n- Redis 6+\n- npm or yarn\n\n### Installation\n\n```bash\n# Clone repository\ngit clone <repository-url>\ncd backend\n\n# Install dependencies\nnpm install\n\n# Setup environment\ncp .env.example .env\n# Edit .env with your configuration\n\n# Setup database\nnpm run db:setup\nnpm run db:migrate\nnpm run db:seed\n\n# Start development server\nnpm run dev\n```\n\n### Environment Configuration\n\n```bash\n# Server Configuration\nPORT=3000\nNODE_ENV=development\nAPI_VERSION=v1\n\n# Database Configuration\nDB_HOST=localhost\nDB_PORT=5432\nDB_NAME=wallet_db\nDB_USER=wallet_user\nDB_PASSWORD=your_secure_password\nDB_SSL=false\n\n# JWT Configuration\nJWT_SECRET=your_jwt_secret_key_here\nJWT_EXPIRES_IN=24h\nJWT_REFRESH_EXPIRES_IN=7d\n\n# Blockchain Configuration\nETH_RPC_URL=https://mainnet.infura.io/v3/your_infura_key\nETH_PRIVATE_KEY=0x...\nCONTRACT_ADDRESS=0x...\nGAS_LIMIT=21000\nGAS_PRICE=20000000000\n\n# Redis Configuration\nREDIS_URL=redis://localhost:6379\nREDIS_PASSWORD=\nREDIS_DB=0\n\n# Security Configuration\nRATE_LIMIT_WINDOW_MS=900000  # 15 minutes\nRATE_LIMIT_MAX_REQUESTS=100\nBCRYPT_SALT_ROUNDS=12\n\n# Monitoring Configuration\nLOG_LEVEL=info\nMETRICS_ENABLED=true\nHEALTH_CHECK_INTERVAL=30000\n```\n\n## ğŸ“ Project Structure\n\n```\nbackend/\nâ”œâ”€â”€ src/\nâ”‚   â”œâ”€â”€ controllers/          # Request handlers\nâ”‚   â”‚   â”œâ”€â”€ authController.ts\nâ”‚   â”‚   â”œâ”€â”€ walletController.ts\nâ”‚   â”‚   â”œâ”€â”€ tokenController.ts\nâ”‚   â”‚   â””â”€â”€ transactionController.ts\nâ”‚   â”œâ”€â”€ services/            # Business logic\nâ”‚   â”‚   â”œâ”€â”€ authService.ts\nâ”‚   â”‚   â”œâ”€â”€ walletService.ts\nâ”‚   â”‚   â”œâ”€â”€ tokenService.ts\nâ”‚   â”‚   â”œâ”€â”€ blockchainService.ts\nâ”‚   â”‚   â””â”€â”€ offlineTokenManager.ts\nâ”‚   â”œâ”€â”€ database/            # Database layer\nâ”‚   â”‚   â”œâ”€â”€ connection.ts\nâ”‚   â”‚   â”œâ”€â”€ dao/            # Data Access Objects\nâ”‚   â”‚   â””â”€â”€ migrations/     # Database migrations\nâ”‚   â”œâ”€â”€ middleware/          # Express middleware\nâ”‚   â”‚   â”œâ”€â”€ auth.ts\nâ”‚   â”‚   â”œâ”€â”€ rateLimiter.ts\nâ”‚   â”‚   â”œâ”€â”€ errorHandler.ts\nâ”‚   â”‚   â””â”€â”€ validation.ts\nâ”‚   â”œâ”€â”€ routes/              # API routes\nâ”‚   â”‚   â”œâ”€â”€ auth.ts\nâ”‚   â”‚   â”œâ”€â”€ wallet.ts\nâ”‚   â”‚   â”œâ”€â”€ tokens.ts\nâ”‚   â”‚   â””â”€â”€ transactions.ts\nâ”‚   â”œâ”€â”€ models/              # Data models\nâ”‚   â”‚   â”œâ”€â”€ User.ts\nâ”‚   â”‚   â”œâ”€â”€ Wallet.ts\nâ”‚   â”‚   â”œâ”€â”€ Transaction.ts\nâ”‚   â”‚   â””â”€â”€ OfflineToken.ts\nâ”‚   â”œâ”€â”€ utils/               # Utility functions\nâ”‚   â”‚   â”œâ”€â”€ logger.ts\nâ”‚   â”‚   â”œâ”€â”€ crypto.ts\nâ”‚   â”‚   â””â”€â”€ validation.ts\nâ”‚   â”œâ”€â”€ config/              # Configuration\nâ”‚   â”‚   â”œâ”€â”€ config.ts\nâ”‚   â”‚   â”œâ”€â”€ database.ts\nâ”‚   â”‚   â””â”€â”€ swagger.ts\nâ”‚   â””â”€â”€ types/               # TypeScript types\nâ”‚       â””â”€â”€ index.ts\nâ”œâ”€â”€ contracts/               # Smart contracts\nâ”‚   â”œâ”€â”€ OfflineWalletToken.sol\nâ”‚   â””â”€â”€ migrations/\nâ”œâ”€â”€ scripts/                 # Deployment scripts\nâ”‚   â”œâ”€â”€ deploy.ts\nâ”‚   â”œâ”€â”€ migrate.ts\nâ”‚   â””â”€â”€ seed.ts\nâ”œâ”€â”€ test/                    # Test files\nâ”‚   â”œâ”€â”€ unit/\nâ”‚   â”œâ”€â”€ integration/\nâ”‚   â””â”€â”€ e2e/\nâ””â”€â”€ infrastructure/          # Infrastructure configs\n    â”œâ”€â”€ docker/\n    â”œâ”€â”€ nginx/\n    â””â”€â”€ monitoring/\n```\n\n## ğŸ” Authentication\n\n### JWT Token Authentication\n\nAll protected endpoints require a valid JWT token in the Authorization header:\n\n```\nAuthorization: Bearer <jwt-token>\n```\n\n### Token Lifecycle\n\n1. **Login**: Get access token and refresh token\n2. **Access**: Use access token for API calls\n3. **Refresh**: Use refresh token to get new access token\n4. **Logout**: Invalidate both tokens\n\n### Authentication Flow\n\n```mermaid\nsequenceDiagram\n    participant Client\n    participant API\n    participant DB\n    \n    Client->>API: POST /auth/login\n    API->>DB: Validate credentials\n    DB-->>API: User data\n    API-->>Client: Access token + Refresh token\n    \n    Client->>API: GET /wallet/balance (with token)\n    API->>API: Validate token\n    API-->>Client: Wallet data\n    \n    Client->>API: POST /auth/refresh\n    API->>API: Validate refresh token\n    API-->>Client: New access token\n```\n\n## ğŸ“š API Endpoints\n\n### Authentication Endpoints\n\n#### POST /api/auth/register\n\nRegister a new user account.\n\n**Request Body:**\n```json\n{\n  \"username\": \"john_doe\",\n  \"email\": \"john@example.com\",\n  \"password\": \"SecurePass123!\",\n  \"confirmPassword\": \"SecurePass123!\"\n}\n```\n\n**Response (201):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"user\": {\n      \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"username\": \"john_doe\",\n      \"email\": \"john@example.com\",\n      \"walletAddress\": \"0x742d35Cc6634C0532925a3b8D404d3aAB451e9c\",\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    },\n    \"tokens\": {\n      \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n      \"refreshToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n      \"expiresIn\": \"24h\"\n    }\n  }\n}\n```\n\n**Validation Rules:**\n- Username: 3-30 characters, alphanumeric and underscore only\n- Email: Valid email format\n- Password: Minimum 8 characters, must contain uppercase, lowercase, number, and special character\n\n#### POST /api/auth/login\n\nAuthenticate user and receive access tokens.\n\n**Request Body:**\n```json\n{\n  \"email\": \"john@example.com\",\n  \"password\": \"SecurePass123!\"\n}\n```\n\n**Response (200):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"user\": {\n      \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"username\": \"john_doe\",\n      \"email\": \"john@example.com\",\n      \"walletAddress\": \"0x742d35Cc6634C0532925a3b8D404d3aAB451e9c\"\n    },\n    \"tokens\": {\n      \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n      \"refreshToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n      \"expiresIn\": \"24h\"\n    }\n  }\n}\n```\n\n#### POST /api/auth/refresh\n\nRefresh access token using refresh token.\n\n**Request Body:**\n```json\n{\n  \"refreshToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n}\n```\n\n**Response (200):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"expiresIn\": \"24h\"\n  }\n}\n```\n\n#### POST /api/auth/logout\n\nInvalidate user tokens.\n\n**Headers:**\n```\nAuthorization: Bearer <access-token>\n```\n\n**Request Body:**\n```json\n{\n  \"refreshToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n}\n```\n\n**Response (200):**\n```json\n{\n  \"success\": true,\n  \"message\": \"Successfully logged out\"\n}\n```\n\n### Wallet Endpoints\n\n#### GET /api/wallet/balance\n\nGet current wallet balance and token information.\n\n**Headers:**\n```\nAuthorization: Bearer <access-token>\n```\n\n**Response (200):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"walletAddress\": \"0x742d35Cc6634C0532925a3b8D404d3aAB451e9c\",\n    \"balances\": {\n      \"blockchain\": {\n        \"amount\": 1250.75,\n        \"currency\": \"ETH\",\n        \"lastUpdated\": \"2024-01-15T10:30:00Z\"\n      },\n      \"offline\": {\n        \"amount\": 125.50,\n        \"tokenCount\": 5,\n        \"lastUpdated\": \"2024-01-15T09:45:00Z\"\n      },\n      \"pending\": {\n        \"amount\": 25.00,\n        \"transactionCount\": 2\n      }\n    },\n    \"totalBalance\": 1401.25\n  }\n}\n```\n\n#### POST /api/wallet/purchase\n\nPurchase tokens for offline use.\n\n**Headers:**\n```\nAuthorization: Bearer <access-token>\n```\n\n**Request Body:**\n```json\n{\n  \"amount\": 100.00,\n  \"paymentMethod\": \"ethereum\",\n  \"transactionHash\": \"0x1234567890abcdef...\",\n  \"gasPrice\": \"20000000000\",\n  \"gasLimit\": \"21000\"\n}\n```\n\n**Response (201):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"transactionId\": \"550e8400-e29b-41d4-a716-446655440001\",\n    \"tokens\": [\n      {\n        \"id\": \"token-uuid-1\",\n        \"amount\": 25.00,\n        \"signature\": \"0x3045022100...\",\n        \"expiresAt\": \"2024-02-15T10:30:00Z\",\n        \"createdAt\": \"2024-01-15T10:30:00Z\"\n      },\n      {\n        \"id\": \"token-uuid-2\",\n        \"amount\": 25.00,\n        \"signature\": \"0x3045022100...\",\n        \"expiresAt\": \"2024-02-15T10:30:00Z\",\n        \"createdAt\": \"2024-01-15T10:30:00Z\"\n      },\n      {\n        \"id\": \"token-uuid-3\",\n        \"amount\": 25.00,\n        \"signature\": \"0x3045022100...\",\n        \"expiresAt\": \"2024-02-15T10:30:00Z\",\n        \"createdAt\": \"2024-01-15T10:30:00Z\"\n      },\n      {\n        \"id\": \"token-uuid-4\",\n        \"amount\": 25.00,\n        \"signature\": \"0x3045022100...\",\n        \"expiresAt\": \"2024-02-15T10:30:00Z\",\n        \"createdAt\": \"2024-01-15T10:30:00Z\"\n      }\n    ],\n    \"totalAmount\": 100.00,\n    \"blockchainTransaction\": {\n      \"hash\": \"0x1234567890abcdef...\",\n      \"blockNumber\": 18500000,\n      \"gasUsed\": \"21000\",\n      \"status\": \"confirmed\"\n    }\n  }\n}\n```\n\n#### POST /api/wallet/redeem\n\nRedeem offline tokens back to blockchain.\n\n**Headers:**\n```\nAuthorization: Bearer <access-token>\n```\n\n**Request Body:**\n```json\n{\n  \"tokens\": [\n    {\n      \"id\": \"token-uuid-1\",\n      \"signature\": \"0x3045022100...\"\n    },\n    {\n      \"id\": \"token-uuid-2\",\n      \"signature\": \"0x3045022100...\"\n    }\n  ],\n  \"destinationAddress\": \"0x742d35Cc6634C0532925a3b8D404d3aAB451e9c\"\n}\n```\n\n**Response (200):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"transactionId\": \"550e8400-e29b-41d4-a716-446655440002\",\n    \"redeemedTokens\": [\n      {\n        \"id\": \"token-uuid-1\",\n        \"amount\": 25.00,\n        \"status\": \"redeemed\"\n      },\n      {\n        \"id\": \"token-uuid-2\",\n        \"amount\": 25.00,\n        \"status\": \"redeemed\"\n      }\n    ],\n    \"totalAmount\": 50.00,\n    \"blockchainTransaction\": {\n      \"hash\": \"0xabcdef1234567890...\",\n      \"status\": \"pending\",\n      \"estimatedConfirmation\": \"2024-01-15T10:35:00Z\"\n    }\n  }\n}\n```\n\n#### GET /api/wallet/history\n\nGet transaction history.\n\n**Headers:**\n```\nAuthorization: Bearer <access-token>\n```\n\n**Query Parameters:**\n- `page` (optional): Page number (default: 1)\n- `limit` (optional): Items per page (default: 20, max: 100)\n- `type` (optional): Transaction type filter\n- `status` (optional): Transaction status filter\n- `startDate` (optional): Start date filter (ISO 8601)\n- `endDate` (optional): End date filter (ISO 8601)\n\n**Response (200):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"transactions\": [\n      {\n        \"id\": \"550e8400-e29b-41d4-a716-446655440003\",\n        \"type\": \"token_purchase\",\n        \"amount\": 100.00,\n        \"status\": \"completed\",\n        \"blockchainHash\": \"0x1234567890abcdef...\",\n        \"createdAt\": \"2024-01-15T10:30:00Z\",\n        \"completedAt\": \"2024-01-15T10:32:00Z\",\n        \"metadata\": {\n          \"tokenCount\": 4,\n          \"gasUsed\": \"21000\"\n        }\n      },\n      {\n        \"id\": \"550e8400-e29b-41d4-a716-446655440004\",\n        \"type\": \"offline_transfer\",\n        \"amount\": 25.00,\n        \"status\": \"pending_sync\",\n        \"recipientAddress\": \"0x987fcdeb51234567...\",\n        \"createdAt\": \"2024-01-15T09:15:00Z\",\n        \"metadata\": {\n          \"transferMethod\": \"bluetooth\",\n          \"deviceName\": \"iPhone 12\"\n        }\n      }\n    ],\n    \"pagination\": {\n      \"currentPage\": 1,\n      \"totalPages\": 5,\n      \"totalItems\": 95,\n      \"itemsPerPage\": 20\n    }\n  }\n}\n```\n\n### Token Endpoints\n\n#### POST /api/tokens/validate\n\nValidate an offline token.\n\n**Headers:**\n```\nAuthorization: Bearer <access-token>\n```\n\n**Request Body:**\n```json\n{\n  \"tokenId\": \"token-uuid-1\",\n  \"signature\": \"0x3045022100...\",\n  \"amount\": 25.00\n}\n```\n\n**Response (200):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"valid\": true,\n    \"token\": {\n      \"id\": \"token-uuid-1\",\n      \"amount\": 25.00,\n      \"ownerId\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"signature\": \"0x3045022100...\",\n      \"isSpent\": false,\n      \"expiresAt\": \"2024-02-15T10:30:00Z\",\n      \"createdAt\": \"2024-01-15T10:30:00Z\"\n    },\n    \"validationDetails\": {\n      \"signatureValid\": true,\n      \"notExpired\": true,\n      \"notSpent\": true,\n      \"ownershipValid\": true\n    }\n  }\n}\n```\n\n#### POST /api/tokens/divide\n\nDivide a token for making change in transactions.\n\n**Headers:**\n```\nAuthorization: Bearer <access-token>\n```\n\n**Request Body:**\n```json\n{\n  \"tokenId\": \"token-uuid-1\",\n  \"paymentAmount\": 15.00,\n  \"signature\": \"0x3045022100...\"\n}\n```\n\n**Response (200):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"originalToken\": {\n      \"id\": \"token-uuid-1\",\n      \"amount\": 25.00,\n      \"status\": \"divided\"\n    },\n    \"paymentToken\": {\n      \"id\": \"payment-token-uuid\",\n      \"amount\": 15.00,\n      \"signature\": \"0x3045022100...\",\n      \"expiresAt\": \"2024-02-15T10:30:00Z\",\n      \"createdAt\": \"2024-01-15T11:00:00Z\"\n    },\n    \"changeToken\": {\n      \"id\": \"change-token-uuid\",\n      \"amount\": 10.00,\n      \"signature\": \"0x3045022100...\",\n      \"expiresAt\": \"2024-02-15T10:30:00Z\",\n      \"createdAt\": \"2024-01-15T11:00:00Z\"\n    }\n  }\n}\n```\n\n#### POST /api/tokens/sync\n\nSynchronize offline transactions with the blockchain.\n\n**Headers:**\n```\nAuthorization: Bearer <access-token>\n```\n\n**Request Body:**\n```json\n{\n  \"transactions\": [\n    {\n      \"id\": \"offline-tx-1\",\n      \"senderId\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"receiverId\": \"550e8400-e29b-41d4-a716-446655440005\",\n      \"amount\": 15.00,\n      \"tokenIds\": [\"payment-token-uuid\"],\n      \"signature\": \"0x3045022100...\",\n      \"timestamp\": \"2024-01-15T11:00:00Z\",\n      \"method\": \"bluetooth\"\n    }\n  ]\n}\n```\n\n**Response (200):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"syncedTransactions\": [\n      {\n        \"offlineId\": \"offline-tx-1\",\n        \"blockchainId\": \"550e8400-e29b-41d4-a716-446655440006\",\n        \"status\": \"synced\",\n        \"blockchainHash\": \"0xdef1234567890abc...\"\n      }\n    ],\n    \"failedTransactions\": [],\n    \"summary\": {\n      \"totalTransactions\": 1,\n      \"successfulSyncs\": 1,\n      \"failedSyncs\": 0\n    }\n  }\n}\n```\n\n### Transaction Endpoints\n\n#### GET /api/transactions/:id\n\nGet detailed transaction information.\n\n**Headers:**\n```\nAuthorization: Bearer <access-token>\n```\n\n**Response (200):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"transaction\": {\n      \"id\": \"550e8400-e29b-41d4-a716-446655440003\",\n      \"type\": \"token_purchase\",\n      \"amount\": 100.00,\n      \"status\": \"completed\",\n      \"senderId\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"receiverId\": null,\n      \"blockchainHash\": \"0x1234567890abcdef...\",\n      \"createdAt\": \"2024-01-15T10:30:00Z\",\n      \"completedAt\": \"2024-01-15T10:32:00Z\",\n      \"metadata\": {\n        \"tokenCount\": 4,\n        \"gasUsed\": \"21000\",\n        \"gasPrice\": \"20000000000\",\n        \"blockNumber\": 18500000\n      }\n    },\n    \"relatedTokens\": [\n      {\n        \"id\": \"token-uuid-1\",\n        \"amount\": 25.00,\n        \"status\": \"active\"\n      },\n      {\n        \"id\": \"token-uuid-2\",\n        \"amount\": 25.00,\n        \"status\": \"active\"\n      },\n      {\n        \"id\": \"token-uuid-3\",\n        \"amount\": 25.00,\n        \"status\": \"active\"\n      },\n      {\n        \"id\": \"token-uuid-4\",\n        \"amount\": 25.00,\n        \"status\": \"active\"\n      }\n    ]\n  }\n}\n```\n\n#### POST /api/transactions/estimate\n\nEstimate transaction costs and fees.\n\n**Headers:**\n```\nAuthorization: Bearer <access-token>\n```\n\n**Request Body:**\n```json\n{\n  \"type\": \"token_purchase\",\n  \"amount\": 100.00,\n  \"paymentMethod\": \"ethereum\"\n}\n```\n\n**Response (200):**\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"estimate\": {\n      \"amount\": 100.00,\n      \"gasLimit\": \"21000\",\n      \"gasPrice\": \"20000000000\",\n      \"gasCost\": 0.00042,\n      \"totalCost\": 100.00042,\n      \"estimatedConfirmationTime\": \"2-5 minutes\"\n    },\n    \"tokenBreakdown\": {\n      \"recommendedTokenCount\": 4,\n      \"tokenAmounts\": [25.00, 25.00, 25.00, 25.00],\n      \"expirationDate\": \"2024-02-15T10:30:00Z\"\n    }\n  }\n}\n```\n\n## ğŸ”’ Security\n\n### Rate Limiting\n\nAll endpoints are protected by rate limiting:\n\n- **Default**: 100 requests per 15 minutes per IP\n- **Authentication**: 5 requests per 15 minutes per IP\n- **Token operations**: 50 requests per 15 minutes per user\n- **Wallet operations**: 30 requests per 15 minutes per user\n\n### Input Validation\n\nAll inputs are validated using Joi schemas:\n\n```typescript\n// Example validation schema\nconst purchaseTokenSchema = Joi.object({\n  amount: Joi.number().positive().max(10000).required(),\n  paymentMethod: Joi.string().valid('ethereum', 'bitcoin').required(),\n  transactionHash: Joi.string().pattern(/^0x[a-fA-F0-9]{64}$/).required()\n});\n```\n\n### Error Handling\n\nStandardized error responses:\n\n```json\n{\n  \"success\": false,\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Invalid input data\",\n    \"details\": {\n      \"field\": \"amount\",\n      \"reason\": \"Amount must be positive\"\n    },\n    \"timestamp\": \"2024-01-15T10:30:00Z\",\n    \"requestId\": \"req-uuid-here\"\n  }\n}\n```\n\n### Common Error Codes\n\n- `AUTHENTICATION_REQUIRED`: Missing or invalid authentication\n- `AUTHORIZATION_FAILED`: Insufficient permissions\n- `VALIDATION_ERROR`: Invalid input data\n- `RESOURCE_NOT_FOUND`: Requested resource doesn't exist\n- `RATE_LIMIT_EXCEEDED`: Too many requests\n- `BLOCKCHAIN_ERROR`: Blockchain operation failed\n- `INSUFFICIENT_BALANCE`: Not enough funds\n- `TOKEN_EXPIRED`: Token has expired\n- `TOKEN_ALREADY_SPENT`: Token has already been used\n- `INTERNAL_SERVER_ERROR`: Unexpected server error\n\n## ğŸ“Š Monitoring and Health Checks\n\n### Health Check Endpoints\n\n#### GET /health\n\nBasic health status.\n\n**Response (200):**\n```json\n{\n  \"status\": \"healthy\",\n  \"timestamp\": \"2024-01-15T10:30:00Z\",\n  \"uptime\": 86400,\n  \"version\": \"1.0.0\"\n}\n```\n\n#### GET /health/detailed\n\nDetailed system status.\n\n**Response (200):**\n```json\n{\n  \"status\": \"healthy\",\n  \"timestamp\": \"2024-01-15T10:30:00Z\",\n  \"services\": {\n    \"database\": {\n      \"status\": \"healthy\",\n      \"responseTime\": 15,\n      \"connections\": {\n        \"active\": 5,\n        \"idle\": 10,\n        \"total\": 15\n      }\n    },\n    \"redis\": {\n      \"status\": \"healthy\",\n      \"responseTime\": 2,\n      \"memory\": {\n        \"used\": \"50MB\",\n        \"peak\": \"75MB\"\n      }\n    },\n    \"blockchain\": {\n      \"status\": \"healthy\",\n      \"responseTime\": 250,\n      \"blockNumber\": 18500000,\n      \"gasPrice\": \"20000000000\"\n    }\n  },\n  \"metrics\": {\n    \"requestsPerMinute\": 45,\n    \"averageResponseTime\": 120,\n    \"errorRate\": 0.02\n  }\n}\n```\n\n#### GET /metrics\n\nPrometheus metrics endpoint.\n\n**Response (200):**\n```\n# HELP http_requests_total Total number of HTTP requests\n# TYPE http_requests_total counter\nhttp_requests_total{method=\"GET\",route=\"/api/wallet/balance\",status_code=\"200\"} 1234\n\n# HELP http_request_duration_seconds HTTP request duration in seconds\n# TYPE http_request_duration_seconds histogram\nhttp_request_duration_seconds_bucket{method=\"GET\",route=\"/api/wallet/balance\",le=\"0.1\"} 800\nhttp_request_duration_seconds_bucket{method=\"GET\",route=\"/api/wallet/balance\",le=\"0.5\"} 1200\n```\n\n## ğŸ§ª Testing\n\n### Running Tests\n\n```bash\n# Run all tests\nnpm test\n\n# Run specific test suites\nnpm run test:unit\nnpm run test:integration\nnpm run test:e2e\nnpm run test:security\n\n# Run with coverage\nnpm run test:coverage\n\n# Run load tests\nnpm run test:load\n```\n\n### Test Structure\n\n```\ntest/\nâ”œâ”€â”€ unit/                    # Unit tests\nâ”‚   â”œâ”€â”€ controllers/\nâ”‚   â”œâ”€â”€ services/\nâ”‚   â””â”€â”€ utils/\nâ”œâ”€â”€ integration/             # Integration tests\nâ”‚   â”œâ”€â”€ api/\nâ”‚   â”œâ”€â”€ database/\nâ”‚   â””â”€â”€ blockchain/\nâ”œâ”€â”€ e2e/                     # End-to-end tests\nâ”‚   â””â”€â”€ workflows/\nâ”œâ”€â”€ security/                # Security tests\nâ”‚   â”œâ”€â”€ authentication/\nâ”‚   â”œâ”€â”€ authorization/\nâ”‚   â””â”€â”€ validation/\nâ””â”€â”€ performance/             # Performance tests\n    â””â”€â”€ load/\n```\n\n### Example Test\n\n```typescript\n// test/integration/api/wallet.test.ts\ndescribe('Wallet API', () => {\n  let authToken: string;\n  \n  beforeEach(async () => {\n    // Setup test user and get auth token\n    const response = await request(app)\n      .post('/api/auth/login')\n      .send({\n        email: 'test@example.com',\n        password: 'TestPass123!'\n      });\n    \n    authToken = response.body.data.tokens.accessToken;\n  });\n  \n  describe('GET /api/wallet/balance', () => {\n    it('should return wallet balance for authenticated user', async () => {\n      const response = await request(app)\n        .get('/api/wallet/balance')\n        .set('Authorization', `Bearer ${authToken}`)\n        .expect(200);\n      \n      expect(response.body.success).toBe(true);\n      expect(response.body.data).toHaveProperty('balances');\n      expect(response.body.data.balances).toHaveProperty('blockchain');\n      expect(response.body.data.balances).toHaveProperty('offline');\n    });\n    \n    it('should return 401 for unauthenticated request', async () => {\n      await request(app)\n        .get('/api/wallet/balance')\n        .expect(401);\n    });\n  });\n});\n```\n\n## ğŸš€ Deployment\n\n### Production Deployment\n\n```bash\n# Build application\nnpm run build\n\n# Run database migrations\nnpm run db:migrate:prod\n\n# Start production server\nnpm run start:prod\n```\n\n### Docker Deployment\n\n```bash\n# Build Docker image\ndocker build -t wallet-api .\n\n# Run with Docker Compose\ndocker-compose -f docker-compose.prod.yml up -d\n```\n\n### Environment-Specific Configuration\n\n```bash\n# Development\ncp .env.development .env\nnpm run dev\n\n# Staging\ncp .env.staging .env\nnpm run start:staging\n\n# Production\ncp .env.production .env\nnpm run start:prod\n```\n\n## ğŸ“ Logging\n\n### Log Levels\n\n- `error`: Error conditions\n- `warn`: Warning conditions\n- `info`: Informational messages\n- `debug`: Debug-level messages\n\n### Log Format\n\n```json\n{\n  \"timestamp\": \"2024-01-15T10:30:00.123Z\",\n  \"level\": \"info\",\n  \"message\": \"User authenticated successfully\",\n  \"userId\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"requestId\": \"req-uuid-here\",\n  \"ip\": \"192.168.1.100\",\n  \"userAgent\": \"Mozilla/5.0...\",\n  \"duration\": 45\n}\n```\n\n### Security Audit Logs\n\n```json\n{\n  \"timestamp\": \"2024-01-15T10:30:00.123Z\",\n  \"level\": \"warn\",\n  \"event\": \"FAILED_LOGIN_ATTEMPT\",\n  \"userId\": null,\n  \"email\": \"attacker@example.com\",\n  \"ip\": \"192.168.1.200\",\n  \"attempts\": 5,\n  \"locked\": true\n}\n```\n\n---\n\n*This API documentation is automatically updated with each release. For the latest version, please refer to the Swagger documentation at `/api-docs` when the server is running.*\n"